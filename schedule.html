<!DOCTYPE html>
<html>
<head>
	<title>Speaker schedule</title>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.25/vue.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/0.9.1/vue-resource.min.js">
	</script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="/css/bootswatch.min.css" />

</head>
<body>

<div class="container">
<br/>
	<div id="speaker-list">
		<div class="row">
			<div class="col-sm-4">
				<div class="btn-group btn-group-sm">
					<button
						class="btn"
						v-bind:class="{ 'btn-default' : '' == selectedDay,
										'btn-info' : '' != selectedDay }"
						@click="selectedDay = ''">
					All Days
					</button>
					<button 
					class="btn" 
					v-bind:class="{ 'btn-default' : day.name == selectedDay,
									'btn-info' : day.name != selectedDay }"
					v-for="day in days"
					@click="selectedDay = day.name"
					>
					{{day.name}}
					</button>
					
				</div>
			</div>
		</div>

		<br/>

		<p>
			<div class="input-group">
				<span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span>
				<input v-model="speakerSearch" class="form-control" />
			</div>
		</p>

		<ul>
			<li v-for="speaker in speakers | speakersFilter ">
				{{speaker.first_name}} {{speaker.last_name}}<br/>{{speaker.speaking_day}} {{speaker.talk.title}}
			</li>
		</ul>
	</div>

</div>

<script>
new Vue({
	el : '#speaker-list',
	data : {
		url : "http://abstractions.io/api/schedule.json",
		days : [],
		speakers : [],
		speakerSearch : '',
		selectedDay : ''
	},
	ready(){

      this.$http.get(this.url).then((goodResponse) => {

          // success callback
          this.days = goodResponse.data.days
          this.setSpeakers()

      }, (badResponse) => {

          // error callback
      });

	},
	filters : {
		speakersFilter(speakers, value, keys){
		    
		    var filterBy = this.$options.filters.filterBy
            speakers = filterBy.call(this, speakers, this.speakerSearch);

            speakers = speakers.filter((speaker) => {
            	if (this.selectedDay) {
	            	return speaker.speaking_day == this.selectedDay
            	}
	            return true
            });

			return speakers;
		}
	},
	methods : {
		setSpeakers(){
			this.days.forEach((day) => {
				day.stages.forEach((stage) => {
					stage.sessions.forEach((session) => {
						session.speaker.speaking_day = day.name;
						session.speaker.talk = session.talk;
						this.speakers.push(session.speaker);
					});
				})
			});

			this.speakers.forEach((speaker) => {

				let names = speaker.name.split(/[\s]/);
				let lastName = names.pop();

				speaker.first_name = names.join(" ");
				speaker.last_name = lastName;

			});

			this.sortSpeakers();
		},
		sortSpeakers(){

			this.speakers.sort((a, b) => {
				if (a.last_name > b.last_name) {
				    return 1;
				  }
				  if (a.last_name < b.last_name) {
				    return -1;
				  }
				  // a must be equal to b
				 return 0;
			});
		}
	}

})
</script>

</body>
</html>